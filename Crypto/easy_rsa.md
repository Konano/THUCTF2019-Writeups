# Easy RSA

解压压缩包，发现里面包含一个加密 `.py` 和一个 `info.txt`。`.py` 如下：

```
import gmpy2
import random
from flag import flag
low = pow(2, 1024)
t = pow(2, 100)
p = gmpy2.next_prime(low + random.randint(t, t * 100))
q = gmpy2.next_prime(low + random.randint(t, t * 100))
n = p*p * q
cf =  pow(q,p * (p - 1) - 1, p*p)
e = 0x10001
flag = flag.encode('hex')
flag = int(flag, 16)
c = pow(flag, e, n)
print ("cf="+str(cf))
print ("n="+str(n))
print ("c="+str(c))
```

`info.txt` 则是附上了 $n$，$cf$ 和 $c$ 的值。

可以观察到 $p$ 和 $q$ 的生成机制是在 $[2^{1024}+2^{100},2^{1024}+100\times 2^{100}]$ 内随机选择一个数，这便可以成为一个突破口。

设 $p=2^{1024}+a$，$q=2^{1024}+b$，则 
$$
\begin{split}
n &= p^2q\\
&=(2^{1000}+a)^2(2^{1000}+b) \\ 
&=2^{3000}+2^{2000}(2a+b)+2^{1000}(2ab+a^2)+a^2b
\end{split}
$$
$a^2b$ 的位数 < 1024 位，所以可以先对 n 进行分解得到 $2a+b$，$2ab+a^2$ 和 $a^2b$ 的值：

```
>>> n % 2**1024
625290994099045943491785181887824985306963521815471285790554167223379151526344069253825728458925L
>>> n = n // 2**1024
>>> n % 2**1024
24737962161222973411370732590213583683692993803321481106674875355L
>>> n = n // 2**1024
>>> n % 2**1024
282725104797970476715720986392367L
>>> n = n // 2**1024
>>> n % 2**1024
1L
```

将 24737962161222973411370732590213583683692993803321481106674875355 丢进 factordb.com，得到其分解式，可知此数因子包含 $a$。求得：
$$
p = 2^{1024} + 119451043781570287318841973668145\\
q = 2^{1024} + 43823017234829902078037039056077
$$
那么接下来就是求逆元得 $d$，解密完即可获得原文，即为 key。